": VIMRC
": Change: Thu Sep 14 10:11:46 AM CDT 2023

": Functions {{{
function WriteDate()
  let l:view = winsaveview()
  :normal! ggj
  :r!date
  normal! kdd
  execute "normal I\": Change:\<Space>\<Esc>"
  call winrestview(l:view)
endfunction

function GetLine()
  if line("'\"") > 1 && line("'\"") <= line("$")
    exe "normal! g'\""
  endif
endfunction

function Indent()
  let l:view = winsaveview()
  normal! gg=G
  call winrestview(l:view)
endfunction

function Whitespace()
  let l:view = winsaveview()
  :%s/\s\+$//e
  call winrestview(l:view)
endfunction
": Fucntions }}}

": Settings {{{
set nocompatible
filetype plugin on
filetype indent on
syntax enable
set backspace=indent,eol,start
set background=dark
set t_Co=256
set termguicolors
set encoding=utf-8

set tabstop=4
set shiftwidth=4
set expandtab
set nowrap
set number
set relativenumber

set autoindent
set autoread
set autochdir
set completeopt=menuone,preview,popup
set cursorlineopt=number
set foldlevel=99
set foldlevelstart=99
set hidden
set ignorecase
set incsearch
set path+=**
set ruler
set laststatus=2
set statusline=(%n)\ %<%F%h%m%r%=%c%V\ [%l:%L]\ \ [%b\ 0x%B]\ \ %p%%\ \ %P\ \ %f\ \ |
set scrolloff=5
set showcmd
set showmatch
set signcolumn=yes
set smartcase
set smartindent
set updatetime=300
set wildmenu
set wildmode=longest,list,full

set directory=~/.vim/backup
set backupdir=~/.vim/backup
set undodir=~/.vim/undodir
set nobackup
set nowritebackup
set undofile
set noswapfile

let mapleader=" "
let maplocalleader="\\"
": Settings }}}

": ALE Pre-Startup {{{
let g:ale_enabled = 1
let g:ale_max_signs = 10
let g:ale_completion_enabled = 1
let g:ale_completion_autoimport = 1
let g:ale_lsp_suggestions = 1
let g:ale_cursor_detail = 1 " 1 gives popup
let g:ale_virtualtext_cursor = 0
let g:ale_detail_to_floating_preview = 1
let g:ale_echo_msg_format = "% code % [%linter%] %type% "
let g:ale_floating_window_border = ['│', '─', '╭', '╮', '╯', '╰', '│', '─']
let g:ale_warn_about_trailing_blank_lines = 1
let g:ale_warn_about_trailing_whitespace = 1
let g:ale_sign_column_always = 1
let g:ale_python_pylint_options = '--rcfile ~/python/pylint.toml'
let g:ale_set_highlights = 0

" Prevents highlights in the code proper. This is a list of strings
let g:ale_exclude_highlights = [
      \ 'docstring',
      \ 'Unused argument',
      \ 'import-errro',
      \ 'SC2164',
      \ 'inconsistent-return-statements',
      \ ]

let g:ale_linters_explicit = 1
let g:ale_lint_on_text_changed = 'normal'
let g:ale_lint_on_insert_leave = 0
let g:ale_lint_on_enter = 1
let g:ale_lint_on_save = 1
let g:ale_fix_on_save = 1 " 0 is default
": END ALE Pre-Startup }}}

": Vim-Plug {{{
call plug#begin()
Plug 'catppuccin/vim'
Plug 'neoclide/coc.nvim', {'branch': 'release'}
Plug 'dense-analysis/ale'
Plug 'mattn/emmet-vim'
Plug 'tpope/vim-commentary'
Plug 'airblade/vim-gitgutter'
Plug 'tpope/vim-fugitive'
Plug 'mbbill/undotree'
Plug 'yggdroot/indentline'
Plug 'easymotion/vim-easymotion'
Plug 'junegunn/fzf.vim'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
call plug#end()
": Vim-Plug }}}

": ALE Post-Startup {{{
let g:ale_linters = {
      \ 'python': ['pylint'],
      \ 'rust': ['analyzer'],
      \ 'vim': [''],
      \ 'cpp': ['clangd', 'cpplint'],
      \ 'json': ['eslint'],
      \ }
let g:ale_fixers = {
      \ '*': ['remove_trailing_lines', 'trim_whitespace'],
      \ 'python': ['black', 'isort'],
      \ 'rust': ['rustfmt'],
      \ 'cpp': ['clang-format'],
      \ 'json': ['prettier'],
      \}
": END ALE Post-Startup }}}

": Coc {{{
let g:coc_global_extensions = [
      \ 'coc-json', 'coc-tsserver', 'coc-snippets', 'coc-eslint', 'coc-sh',
      \ 'coc-rust-analyzer', 'coc-markdownlint', 'coc-jedi', 'coc-cmake',
      \ 'coc-clangd'
      \ ]

" use <tab> to trigger completion and navigate to the next complete item
" function! CheckBackspace() abort
"   let col = col('.') - 1
"   return !col || getline('.')[col - 1]  =~# '\s'
" endfunction

" inoremap <silent><expr> <Tab>
"             \ coc#pum#visible() ? coc#pum#next(1) :
"             \ CheckBackspace() ? "\<Tab>" :
"             \ coc#refresh()

inoremap <silent><expr> <TAB>
      \ pumvisible() ? coc#_select_confirm() :
      \ coc#expandableOrJumpable() ? "\<C-r>=coc#rpc#request('doKeymap', ['snippets-expand-jump',''])\<CR>" :
      \ CheckBackSpace() ? "\<TAB>" :
      \ coc#refresh()

function! CheckBackSpace() abort
  let col = col('.') - 1
  return !col || getline('.')[col - 1]  =~# '\s'
endfunction

let g:coc_snippet_next = '<tab>'

inoremap <silent><expr> <cr> coc#pum#visible() ? coc#_select_confirm() : "\<C-g>u\<CR>"

" inoremap <expr> <cr> coc#pum#visible() ? coc#pum#confirm() : "\<CR>"
" inoremap <expr> <Tab> coc#pum#visible() ? coc#pum#next(1) : "\<Tab>"
" inoremap <expr> <S-Tab> coc#pum#visible() ? coc#pum#prev(1) : "\<S-Tab>"
": Coc }}}

": Plugins {{{
" let g:snipMate = { 'snippet_version': 1 }

nnoremap <leader>of :FZF<cr>
nnoremap <leader>oh :FZF ~<CR>
nnoremap <leader>ob :Buffers<cr>
nnoremap <leader>oc :Colors<cr>
nnoremap <leader>oll :Lines<cr>
nnoremap <leader>olb :BLines<cr>
nnoremap <leader>ott :Tags<cr>
nnoremap <leader>otb :BTags<cr>
nnoremap <leader>om :Marks<cr>
nnoremap <leader>oj :Jumps<cr>
nnoremap <leader>op :Maps<cr>

nmap <leader>mf <Plug>(easymotion-bd-f)
nmap <leader>mf <Plug>(easymotion-overwin-f)
nmap <leader>ms <Plug>(easymotion-bd-s)
nmap <leader>ms <Plug>(easymotion-overwin-f2)
nmap <leader>ml <plug>(easymotion-bd-jk)
nmap <leader>ml <Plug>(easymotion-overwin-line)
nmap <leader>mw <Plug>(easymotion-bd-w)
nmap <leader>mw <Plug>(easymotion-overwin-w)

let g:undotree_SplitWidth=40
let g:undotree_ShortIndicators=1
let g:undotree_HighlightChangedText=0

nnoremap <leader>ut :UndotreeToggle<cr>

let g:indentLine_char = '▏'
" let g:indentLine_char_list = ['▏', '▏', '┊']
let g:indentLine_setColors = 0
let g:indentLine_defaultGroup = 'SpecialKey'
let g:indentLine_concealcursor = 'inc'
let g:indentLine_conceallevel = 2
" let g:indentLine_setConceal = 0

let g:netrw_banner=0
let g:netrw_altv=1
let g:netrw_liststyle=3
let g:netrw_list_hide=netrw_gitignore#Hide()
let g:netrw_list_hide.=',\(^\|\s\s\)\zs\.\s\+'

let g:user_emmet_mode='a'
let g:user_emmet_install_global=0
let g:user_emmet_leader_key=','

colorscheme catppuccin_mocha
": Plugins }}}

": Mappings {{{
command! MakeTags !ctags -R .

inoremap kj <ESC>
vnoremap kj <ESC>

nnoremap <leader>w :write<CR>
nnoremap <localleader>w :wall<CR>
nnoremap <leader>z :write<CR>:quit<CR>
nnoremap <localleader>z :xall<CR>
nnoremap <leader>q :quit!<CR>
nnoremap <leader>o :edit .<CR>
nnoremap <leader>t :write<CR>:term<CR>
nnoremap <localleader>t :shell<CR>

nnoremap <localleader>e :write<CR>:edit $MYVIMRC<CR>
nnoremap <localleader>ve :write<CR>:vsplit<CR><C-w>l:edit $MYVIMRC<CR>
nnoremap <localleader>s :write<CR>:source $MYVIMRC<CR>:do FileType<CR>:do BufEnter<CR>

nnoremap <C-f> <C-d>
nnoremap zz zt
nnoremap E $
nnoremap Y y$
nnoremap B _
nnoremap w W
nnoremap n nzz
nnoremap N Nzz
nnoremap ' `
nnoremap '' ``
vnoremap J :m '>+1<cr>gv=gv
vnoremap K :m '<-2<cr>gv=gv
vnoremap < <gv
vnoremap > >gv
nnoremap <leader>bn :bnext<cr>
nnoremap <leader>bp :bprev<cr>

nnoremap H gT
nnoremap L gt
nnoremap <leader>to :tabnew<CR>
nnoremap <leader>tc :tabclose<CR>

nnoremap <leader>v :vsplit<cr><C-w>l
nnoremap <localleader>v :split<cr><C-w>j

nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l
nnoremap <leader>ll :vertical resize+
nnoremap <leader>kk :resize+
": Mappings }}}

": Groups {{{
augroup ALL
  autocmd!
  autocmd InsertEnter * set nornu
  autocmd InsertLeave * set rnu
  autocmd BufEnter * if line("'\"") > 1 && line("'\"") <= line("$") | exec "normal g'\"" | endif
  autocmd BufWritePre * call Whitespace()
  autocmd BufWritePre * call Indent()
  autocmd BufWritePre $MYVIMRC call WriteDate()
augroup END

augroup FILETYPES
  autocmd!
  autocmd FileType vim setlocal ts=2 sw=2 fdc=0 fdm=marker scl=no fdl=0 fdls=-1
  autocmd FileType python setlocal cc=90 fdm=indent fdc=0
  autocmd FileType c setlocal fdm=indent noai nosi noci cin cino=ln,c2
  autocmd FileType rust setlocal fdm=indent noai nosi noci cin cino=ln,c2
  autocmd FileType html,css setlocal ts=2 sw=2 tw=0 fdm=manual aw ut=1000 cc=80,100,120
  autocmd FileType json syntax match Comment +\/\/.\+$+
  autocmd Filetype text setlocal ts=8 sw=8 sts=4 tw=80 noet wrap noai nosi noci fdc=0 scl=no cc=80
  autocmd FileType text,html,htmldjango,css EmmetInstall
augroup END

augroup CODERUNNERS
  autocmd!
  autocmd BufWinEnter *.py nnoremap <F5> :write<CR>:!python3 %<CR>
  autocmd BufWinEnter *.c nnoremap <buffer> <leader>mm :!make main<CR>
  autocmd BufWinEnter *.c nnoremap <F5> :write<cr>:!./main
augroup END

augroup HTML
  autocmd!
  autocmd BufEnter *.html nnoremap <buffer> <localleader>f Vatzf
  autocmd BufEnter *.html nnoremap <buffer> <localleader>c i<!----><esc>2hi<space><esc>i<space>
  autocmd BufEnter *.html onoremap <buffer> it :<c-u>normal! f<vi<<cr>
  autocmd BufEnter *.css nnoremap <buffer> <localleader>c i/**/<esc>hi<space><esc>i<space>
  autocmd CursorHold *.html,*.css write
augroup END

augroup ABBREV
  autocmd!
  autocmd BufEnter * iabbrev ifos itsf4llofstars
  autocmd BufEnter * iabbrev memail irooted4hal@mailfence.com
  autocmd BufEnter * iabbrev slef self
  autocmd BufEnter * iabbrev sefl self
  autocmd BufEnter * iabbrev sfel self
  autocmd BufEnter * iabbrev pirnt print
  autocmd BufEnter * iabbrev prnit print
  autocmd BufEnter * iabbrev pritn print
  autocmd BufEnter * iabbrev prtn print
  autocmd BufEnter * iabbrev prnt print
  autocmd BufEnter * iabbrev retrun return
augroup END

augroup TEST
  au!
  autocmd BufWinLeave *.txt :normal! ggOBufWinLeave
  autocmd BufLeave *.txt :normal! GoBufLeave
augroup END
": Groups }}}
